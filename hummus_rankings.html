<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hummus Fest 2026</title>
<link href="https://fonts.googleapis.com/css2?family=Frank+Ruhl+Libre:wght@300;400;700;900&family=Assistant:wght@300;400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="">
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<style>
  :root {
    --cream: #F5EDD6;
    --warm: #E8D5AA;
    --gold: #C8941A;
    --deep: #3D2B0E;
    --rust: #B5451B;
    --olive: #6B7C3A;
    --tahini: #D4A853;
    --pita: #E8C87A;
    --bg: #FAF4E8;
    --card: #FFFDF7;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { font-family: 'Assistant', sans-serif; background: var(--bg); color: var(--deep); direction: rtl; text-align: right; overflow-x: hidden; }
  body::before { content: ''; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.04'/%3E%3C/svg%3E"); pointer-events: none; z-index: 1000; opacity: 0.4; }
  .hero { background: var(--deep); color: var(--cream); padding: 4rem 2rem 3rem; text-align: center; position: relative; overflow: hidden; }
  .hero::before { content: ''; position: absolute; top: -50%; left: -20%; width: 140%; height: 200%; background: radial-gradient(ellipse at 30% 40%, rgba(200,148,26,0.3) 0%, transparent 60%), radial-gradient(ellipse at 70% 70%, rgba(181,69,27,0.2) 0%, transparent 50%); }
  @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
  .hero h1 { font-family: 'Frank Ruhl Libre', serif; font-size: clamp(2.5rem, 6vw, 5rem); font-weight: 900; line-height: 1.1; margin-top: 0; position: relative; }
  .hero h1 span { color: var(--tahini); }
  .hero-sub { font-size: 1.1rem; font-weight: 300; opacity: 0.8; margin-top: 0.75rem; position: relative; letter-spacing: 0.05em; }
  .stats-bar { display: flex; justify-content: center; gap: 3rem; margin-top: 2.5rem; position: relative; }
  .stat-item { text-align: center; }
  .stat-num { font-family: 'Frank Ruhl Libre', serif; font-size: 2.5rem; font-weight: 900; color: var(--tahini); }
  .stat-label { font-size: 0.8rem; opacity: 0.7; font-weight: 300; letter-spacing: 0.05em; }
  .container { max-width: 1100px; margin: 0 auto; padding: 0 1.5rem; }
  .section { padding: 4rem 0; }
  .section-title { font-family: 'Frank Ruhl Libre', serif; font-size: 2.2rem; font-weight: 700; color: var(--deep); margin-bottom: 0.25rem; }
  .section-subtitle { font-size: 0.95rem; color: var(--rust); font-weight: 600; letter-spacing: 0.1em; text-transform: uppercase; margin-bottom: 0.5rem; }
  .section-desc { font-size: 1rem; opacity: 0.7; margin-bottom: 2.5rem; max-width: 600px; }
  .divider { width: 60px; height: 3px; background: var(--gold); margin-bottom: 1.5rem; }
  .podium { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1.5rem; margin-bottom: 2rem; }
  .podium-card { background: var(--card); border-radius: 16px; padding: 2rem 1.5rem; text-align: center; position: relative; box-shadow: 0 4px 24px rgba(61,43,14,0.08); border: 1px solid rgba(200,148,26,0.15); transition: transform 0.2s; }
  .podium-card:hover { transform: translateY(-4px); }
  .podium-card.gold { border: 2px solid var(--gold); background: linear-gradient(135deg, #FFFDF0, #FFF8E1); }
  .podium-card.silver { border: 2px solid #A8B0B8; background: linear-gradient(135deg, #FAFBFC, #F0F3F5); }
  .podium-card.bronze { border: 2px solid #C8956C; background: linear-gradient(135deg, #FFF8F5, #FFF0E8); }
  .medal { font-size: 2.5rem; }
  .place-rank { font-size: 0.85rem; font-weight: 700; letter-spacing: 0.1em; text-transform: uppercase; opacity: 0.5; margin: 0.5rem 0 0.25rem; }
  .place-name { font-family: 'Frank Ruhl Libre', serif; font-size: 1.5rem; font-weight: 700; color: var(--deep); }
  .place-addr { font-size: 0.78rem; opacity: 0.55; margin-top: 0.25rem; }
  .place-score { font-size: 2rem; font-weight: 900; color: var(--gold); font-family: 'Frank Ruhl Libre', serif; }
  .place-score-label { font-size: 0.75rem; opacity: 0.5; }
  .scores-table { background: var(--card); border-radius: 16px; overflow: hidden; box-shadow: 0 4px 24px rgba(61,43,14,0.08); }
  .score-row { display: grid; grid-template-columns: 2rem 1fr 180px 80px; align-items: center; padding: 1rem 1.5rem; gap: 1rem; border-bottom: 1px solid rgba(200,148,26,0.1); transition: background 0.2s; }
  .score-row:hover { background: var(--warm); }
  .score-row:last-child { border-bottom: none; }
  .row-num { font-weight: 700; opacity: 0.4; font-size: 0.85rem; }
  .row-name { font-weight: 600; font-size: 1rem; }
  .row-addr { font-size: 0.72rem; opacity: 0.5; }
  .bar-container { height: 10px; background: var(--warm); border-radius: 5px; overflow: hidden; }
  .bar-fill { height: 100%; border-radius: 5px; }
  .bar-hummus { background: linear-gradient(90deg, var(--rust), var(--gold)); }
  .bar-pita { background: linear-gradient(90deg, var(--olive), #8FA84A); }
  .row-avg { font-family: 'Frank Ruhl Libre', serif; font-weight: 700; font-size: 1.2rem; color: var(--deep); text-align: center; }
  .two-col { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; }
  .cat-card { background: var(--card); border-radius: 16px; padding: 2rem; box-shadow: 0 4px 24px rgba(61,43,14,0.08); }
  .cat-title { font-family: 'Frank Ruhl Libre', serif; font-size: 1.4rem; font-weight: 700; margin-bottom: 1.5rem; display: flex; align-items: center; gap: 0.5rem; }
  .mini-winner { display: flex; align-items: center; justify-content: space-between; padding: 0.75rem 1rem; border-radius: 10px; margin-bottom: 0.75rem; background: var(--bg); }
  .mini-winner:first-of-type { background: rgba(200,148,26,0.15); }
  .mini-name { font-weight: 600; }
  .mini-score { font-family: 'Frank Ruhl Libre', serif; font-weight: 700; font-size: 1.3rem; color: var(--gold); }
  .polar-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 1.25rem; }
  .polar-card { background: var(--card); border-radius: 14px; padding: 1.5rem; box-shadow: 0 4px 20px rgba(61,43,14,0.08); border-right: 4px solid var(--rust); }
  .polar-place { font-family: 'Frank Ruhl Libre', serif; font-weight: 700; font-size: 1.2rem; margin-bottom: 0.75rem; }
  .polar-stat { display: flex; justify-content: space-between; margin-bottom: 0.35rem; font-size: 0.9rem; }
  .polar-label { opacity: 0.6; }
  .polar-value { font-weight: 700; }
  .std-indicator { margin-top: 0.75rem; height: 8px; border-radius: 4px; background: linear-gradient(90deg, var(--olive), var(--gold), var(--rust)); position: relative; }
  .std-marker { position: absolute; top: -3px; width: 14px; height: 14px; border-radius: 50%; background: var(--deep); border: 2px solid white; transform: translateX(-50%); }
  .chart-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; }
  .chart-card { background: var(--card); border-radius: 16px; padding: 1.5rem; box-shadow: 0 4px 24px rgba(61,43,14,0.08); }
  .chart-card.full { grid-column: 1 / -1; }
  .chart-title { font-family: 'Frank Ruhl Libre', serif; font-size: 1.2rem; font-weight: 700; margin-bottom: 1.25rem; }
  .diversity-list { display: flex; flex-direction: column; gap: 0.75rem; }
  .diversity-item { display: grid; grid-template-columns: 1fr 120px 50px; align-items: center; gap: 1rem; padding: 0.75rem 1rem; border-radius: 10px; background: var(--bg); font-size: 0.9rem; }
  .div-name { font-weight: 600; }
  .div-val { font-weight: 700; font-family: 'Frank Ruhl Libre', serif; font-size: 1.1rem; text-align: center; color: var(--rust); }
  .rankers-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 1.25rem; }
  .ranker-card { background: var(--card); border-radius: 14px; padding: 1.5rem; box-shadow: 0 4px 20px rgba(61,43,14,0.08); position: relative; transition: transform 0.2s; }
  .ranker-card:hover { transform: translateY(-3px); }
  .ranker-name { font-family: 'Frank Ruhl Libre', serif; font-weight: 700; font-size: 1.3rem; margin-bottom: 1rem; }
  .ranker-badge { position: absolute; top: 1rem; left: 1rem; background: var(--deep); color: var(--cream); font-size: 0.75rem; font-weight: 700; padding: 0.25rem 0.6rem; border-radius: 20px; letter-spacing: 0.05em; }
  .ranker-badge.champion { background: var(--gold); color: var(--deep); }
  .ranker-badge.sharp { background: var(--olive); }
  .guess-pills { display: flex; flex-wrap: wrap; gap: 0.4rem; margin-top: 0.75rem; }
  .pill { font-size: 0.75rem; padding: 0.2rem 0.6rem; border-radius: 20px; font-weight: 600; }
  .pill.correct { background: rgba(107,124,58,0.2); color: var(--olive); border: 1px solid var(--olive); }
  .pill.wrong { background: rgba(181,69,27,0.1); color: var(--rust); border: 1px solid rgba(181,69,27,0.3); }
  .ranker-stat { font-size: 0.9rem; margin-bottom: 0.3rem; }
  .ranker-stat span { font-weight: 700; }
  .winner-banner { background: linear-gradient(135deg, var(--deep), #5D3B1A); color: var(--cream); border-radius: 20px; padding: 2rem 2.5rem; display: flex; align-items: center; gap: 2rem; margin-bottom: 2rem; position: relative; overflow: hidden; }
  .winner-banner::before { content: 'ğŸŒ¶ï¸'; position: absolute; right: -1rem; bottom: -1rem; font-size: 8rem; opacity: 0.15; }
  .winner-banner.crown-banner::before { content: 'ğŸ‘‘'; }
  .winner-text h2 { font-family: 'Frank Ruhl Libre', serif; font-size: 2rem; }
  .winner-text p { opacity: 0.7; margin-top: 0.25rem; }
  .winner-emoji { font-size: 4rem; }
  .separator { border: none; height: 1px; background: linear-gradient(90deg, transparent, var(--warm), transparent); margin: 0; }
  .fade-in { opacity: 0; transform: translateY(20px); animation: fadeIn 0.7s ease forwards; }
  @keyframes fadeIn { to { opacity: 1; transform: translateY(0); } }
  .fade-in:nth-child(1) { animation-delay: 0.1s; }
  .fade-in:nth-child(2) { animation-delay: 0.2s; }
  .fade-in:nth-child(3) { animation-delay: 0.3s; }

  /* MAP */
  .map-section { background: var(--card); border-radius: 16px; overflow: hidden; box-shadow: 0 4px 24px rgba(61,43,14,0.08); }
  .map-frame { position: relative; width: 100%; height: 480px; background: var(--warm); }
  .map-container { width: 100%; height: 100%; }
  #map { width: 100%; height: 100%; min-height: 480px; }
  .places-legend { padding: 1.5rem; display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 0.75rem; }
  .legend-place { display: flex; align-items: flex-start; gap: 0.6rem; padding: 0.6rem; border-radius: 8px; transition: background 0.2s; }
  .legend-place:hover { background: var(--warm); }
  .legend-num { width: 24px; height: 24px; border-radius: 50%; background: var(--deep); color: var(--cream); font-size: 0.7rem; font-weight: 700; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
  .legend-info { flex: 1; }
  .legend-name { font-weight: 700; font-size: 0.9rem; }
  .legend-addr { font-size: 0.75rem; opacity: 0.55; }

  /* HEATMAP */
  table.heat-table { border-collapse: separate; border-spacing: 3px; direction: rtl; }
  table.heat-table th { padding: 0.4rem 0.5rem; font-size: 0.75rem; font-weight: 600; opacity: 0.6; text-align: center; white-space: nowrap; writing-mode: vertical-rl; }
  table.heat-table td { text-align: center; }
  .row-header { font-size: 0.8rem; font-weight: 600; padding: 0 0.75rem 0 0.25rem; white-space: nowrap; text-align: right; }
  .heat-cell { width: 36px; height: 36px; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 0.75rem; font-weight: 700; color: var(--deep); }
  
  footer { background: var(--deep); color: var(--cream); text-align: center; padding: 2rem; font-size: 0.85rem; opacity: 0.9; }
  @media (max-width: 700px) {
    .podium { grid-template-columns: 1fr; }
    .two-col, .chart-grid { grid-template-columns: 1fr; }
    .score-row { grid-template-columns: 2rem 1fr 60px; }
    .bar-container { display: none; }
    .stats-bar { gap: 1.5rem; }
  }

  /* Print / PDF: preserve colors and avoid ugly breaks */
  @media print {
    body { background: #FAF4E8; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
    body::before { opacity: 0.15; }
    .hero, .winner-banner, .podium-card, .cat-card, .chart-card, .polar-card, .ranker-card,
    .scores-table, .map-section, footer { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
    .section { padding: 2rem 0; page-break-inside: avoid; }
    .podium, .two-col, .chart-grid, .polar-grid { page-break-inside: avoid; }
    .podium-card, .cat-card, .chart-card, .polar-card, .ranker-card, .winner-banner { page-break-inside: avoid; }
    .map-frame { height: 380px; }
    #map { min-height: 380px; }
    .separator { margin: 1rem 0; }
    footer { margin-top: 1rem; }
  }
</style>
</head>
<body>

<div class="hero">
  <h1>Hummus Fest <span>2026</span></h1>
  <p class="hero-sub">24 ×‘×¤×‘×¨×•××¨ 2026 Â· 8 ××§×•××•×ª Â· 22 ××“×¨×’×™×</p>
  <div class="stats-bar">
    <div class="stat-item"><div class="stat-num" id="hero-rankers">22</div><div class="stat-label">××“×¨×’×™×</div></div>
    <div class="stat-item"><div class="stat-num">8</div><div class="stat-label">××§×•××•×ª</div></div>
    <div class="stat-item"><div class="stat-num" id="hero-ratings">â€”</div><div class="stat-label">×¦×™×•× ×™×</div></div>
    <div class="stat-item"><div class="stat-num" id="hero-guesses">â€”</div><div class="stat-label">× ×™×—×•×©×™× × ×›×•× ×™×</div></div>
  </div>
</div>

<div class="container">

  <div class="section">
    <div class="section-subtitle">ğŸ¥‡ ×”×× ×¦×—×™×</div>
    <h2 class="section-title">××œ×›×™ ×”×—×•××•×¡</h2>
    <div class="divider"></div>
    <p class="section-desc">×××•×¦×¢ ×¦×™×•× ×™ ×”×—×•××•×¡ ×× ×•×¨××œ - ×›×“×™ ×œ× ×˜×¨×œ ××ª ×”×©×¤×¢×ª ×”×˜×•×•×— ×”××™×©×™ ×©×œ ×›×œ ××©×ª×ª×¤.×ª</p>
    <div class="podium" id="hummusPodium"></div>
    <div class="scores-table" id="scoresTable"></div>
  </div>

  <hr class="separator">

  <div class="section">
    <div class="section-subtitle">ğŸ«“ ×§×˜×’×•×¨×™×•×ª</div>
    <h2 class="section-title">×—×•××•×¡ ×•×¤×™×ª×” ×‘× ×¤×¨×“</h2>
    <div class="divider"></div>
    <div class="two-col" id="categoryWinners"></div>
  </div>

  <hr class="separator">

  <div class="section">
    <div class="section-subtitle">ğŸŒªï¸ ×¤×™×œ×•×’ ×•×”×¡×ª×”</div>
    <h2 class="section-title">×”×›×™ ×©× ×•×™×™× ×‘××—×œ×•×§×ª</h2>
    <div class="divider"></div>
    <p class="section-desc">××œ×• ×”××§×•××•×ª ×©×¢×•×¨×¨×• ××ª ×”×“×¢×•×ª ×”×›×™ ×©×•× ×•×ª â€” ×©×•× ×•×ª ×’×‘×•×”×” ×‘×™×Ÿ ×”×©×•×¤×˜×™×</p>
    <div class="polar-grid" id="polarGrid"></div>
  </div>

  <hr class="separator">

  <div class="section">
    <div class="section-subtitle">ğŸ“ ×¢×œ ×”××¤×”</div>
    <h2 class="section-title">8 ×”××§×•××•×ª â€” ×’×•×© ×“×Ÿ</h2>
    <div class="divider"></div>
    <div class="map-section">
      <div class="map-frame">
        <div id="map"></div>
      </div>
      <div class="places-legend" id="placesLegend"></div>
    </div>
  </div>

  <hr class="separator">

  <div class="section">
    <div class="section-subtitle">ğŸ—ºï¸ ××¤×ª ×—×•×</div>
    <h2 class="section-title">×›×œ ×”×¦×™×•× ×™×</h2>
    <div class="divider"></div>
    <div class="chart-card" style="overflow-x:auto;">
      <div class="chart-title">×¦×™×•× ×™ ×—×•××•×¡ â€” ××©×ª×ª×¤.×ª Ã— ××§×•×</div>
      <table class="heat-table" id="heatTable"></table>
    </div>
  </div>

  <hr class="separator">

  <div class="section">
    <div class="section-subtitle">ğŸ“Š × ×™×ª×•×—</div>
    <h2 class="section-title">×ª×‘× ×™×•×ª ×•×ª×•×‘× ×•×ª</h2>
    <div class="divider"></div>
    <div class="chart-grid">
      <div class="chart-card">
        <div class="chart-title">×¤×™×–×•×¨ ×¦×™×•× ×™× ×œ×¤×™ ××§×•×</div>
        <canvas id="radarChart"></canvas>
      </div>
      <div class="chart-card">
        <div class="chart-title">×—×•××•×¡ ××•×œ ×¤×™×ª×”</div>
        <canvas id="scatterChart"></canvas>
      </div>
      <div class="chart-card full">
        <div class="chart-title">×¦×™×•× ×™× ×××•×¦×¢×™× â€” ×›×œ ×”××§×•××•×ª (×× ×•×¨××œ)</div>
        <canvas id="barChart"></canvas>
      </div>
    </div>
  </div>

  <hr class="separator">

  <div class="section">
    <div class="section-subtitle">ğŸ•µï¸ ×”×©×•×¤×˜×™×</div>
    <h2 class="section-title">×‘×“×•×š ××• ×‘×¡×™×‘×•×‘?</h2>
    <div class="divider"></div>
    <div class="two-col" style="margin-bottom:2.5rem;">
      <div>
        <div class="chart-title" style="margin-bottom:1rem;">âš¡ ×”×›×™ ××’×•×•× ×™× â€” ××©×ª×ª×¤×™× ×©× ×ª× ×• ×˜×•×•×— ×¦×™×•× ×™× ×¨×—×‘</div>
        <div class="diversity-list" id="diverseList"></div>
      </div>
      <div>
        <div class="chart-title" style="margin-bottom:1rem;">ğŸ˜ ×”×›×™ ××“×™×©×™× â€” ××©×ª×ª×¤×™× ×©× ×ª× ×• ×¦×™×•× ×™× ××—×™×“×™×</div>
        <div class="diversity-list" id="indifferentList"></div>
      </div>
    </div>
    <div class="chart-title" style="margin-bottom:1.5rem;">ğŸŒ¶ï¸ × ×™×—×•×©×™× × ×›×•× ×™× â€” ××™ ×–×™×”×” ××ª ×”××§×•××•×ª?</div>
    <div class="rankers-grid" id="rankersGrid"></div>
  </div>

  <hr class="separator">

  <div class="section" id="guessWinnerSection" style="display:none;">
    <div class="winner-banner">
      <div class="winner-emoji">ğŸŒ¶ï¸</div>
      <div class="winner-text">
        <h2 id="guessWinnerName"></h2>
        <p id="guessWinnerDesc"></p>
      </div>
    </div>
  </div>

  <div class="section">
    <div class="winner-banner crown-banner">
      <div class="winner-emoji">ğŸ‘‘</div>
      <div class="winner-text">
        <h2>×ª××™×¨ - ××œ×š ×”×—×•××•×¡!</h2>
        <p>×ª×•×“×” ×©×œ×§×—×ª ××•×ª× ×• ×œ××¡×¢ ×‘×™×Ÿ ×’×¨×’×¨×™×</p>
      </div>
    </div>
  </div>

</div>

<footer>Hummus Fest 2026</footer>

<script>
const PLACES = {
  1: { name: '×—××•×“×•×ª', addr: '×™×¦×—×§ ×©×“×” 28, ×ª×œ ××‘×™×‘' },
  2: { name: '××œ ×§×œ×—×”', addr: '×“×¨×š ×©×œ××” 3, ×™×¤×•' },
  3: { name: '××‘×• ×—×¡××Ÿ', addr: '×”×“×•×œ×¤×™×Ÿ 1, ×™×¤×•' },
  4: { name: '×œ×™××•×¨', addr: '××™×™×¡×¨×œ×™×© 22, ×ª×œ ××‘×™×‘' },
  5: { name: '×”×›×¨×', addr: '×©×•×§×Ÿ 30, ×ª×œ ××‘×™×‘' },
  6: { name: '××¡×œ×™', addr: '×“×™×–× ×’×•×£ 338, ×ª×œ ××‘×™×‘' },
  7: { name: '×›×•×¨×–×™×Ÿ', addr: '×›×•×¨×–×™×Ÿ 5, ×’×‘×¢×ª×™×™×' },
  8: { name: '××‘×• ××“×”×', addr: '×§×¨×œ×™×‘×š 7, ×ª×œ ××‘×™×‘' },
};

const PLACE_COORDS = [
  { id:1, name:'×—××•×“×•×ª', addr:'×™×¦×—×§ ×©×“×” 28, ×ª×œ ××‘×™×‘', lat:32.0649, lng:34.7872 },
  { id:2, name:'××œ ×§×œ×—×”', addr:'×“×¨×š ×©×œ××” 3, ×™×¤×•', lat:32.0550, lng:34.7601 },
  { id:3, name:'××‘×• ×—×¡××Ÿ', addr:'×”×“×•×œ×¤×™×Ÿ 1, ×™×¤×•', lat:32.0503, lng:34.7509 },
  { id:4, name:'×œ×™××•×¨', addr:'××™×™×¡×¨×œ×™×© 22, ×ª×œ ××‘×™×‘', lat:32.0710, lng:34.7922 },
  { id:5, name:'×”×›×¨×', addr:'×©×•×§×Ÿ 30, ×ª×œ ××‘×™×‘', lat:32.0516, lng:34.7720 },
  { id:6, name:'××¡×œ×™', addr:'×“×™×–× ×’×•×£ 338, ×ª×œ ××‘×™×‘', lat:32.0968, lng:34.7760 },
  { id:7, name:'×›×•×¨×–×™×Ÿ', addr:'×›×•×¨×–×™×Ÿ 5, ×’×‘×¢×ª×™×™×', lat:32.0599, lng:34.8162 },
  { id:8, name:'××‘×• ××“×”×', addr:'×§×¨×œ×™×‘×š 7, ×ª×œ ××‘×™×‘', lat:32.0668, lng:34.7833 },
];

// Build places legend
const legendEl = document.getElementById('placesLegend');
PLACE_COORDS.forEach(p => {
  legendEl.innerHTML += `<div class="legend-place">
    <div class="legend-num">${p.id}</div>
    <div class="legend-info">
      <div class="legend-name">${p.name}</div>
      <div class="legend-addr">${p.addr}</div>
    </div>
  </div>`;
});

// Build interactive map with Leaflet: show all restaurants and fit bounds
const mapEl = document.getElementById('map');
if (mapEl && typeof L !== 'undefined') {
  const map = L.map('map').setView([32.073, 34.783], 12);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'
  }).addTo(map);
  const bounds = [];
  PLACE_COORDS.forEach(p => {
    const marker = L.marker([p.lat, p.lng]).addTo(map);
    marker.bindPopup(`<strong>${p.id}. ${p.name}</strong><br>${p.addr}`);
    bounds.push([p.lat, p.lng]);
  });
  if (bounds.length) {
    map.fitBounds(bounds, { padding: [30, 30], maxZoom: 14 });
  }
}

// ===== DATA =====
// Normalization: rankers who used 1-10 scale: ×œ×™××•×¨, ×ª××™×¨, ×œ×™×”×™, ×‘×’×’
// Detect scale: if max score > 6, assume 1-10, normalize to 1-5 by dividing by 2
const rawData = [
  ['×¢× ×‘×¨',1,3,3,null],['×¢× ×‘×¨',2,1,2,null],['×¢× ×‘×¨',3,2,2,null],['×¢× ×‘×¨',4,3,3,null],['×¢× ×‘×¨',5,4,4,'××œ×™×”×•'],['×¢× ×‘×¨',6,2,2,null],['×¢× ×‘×¨',7,3,3,'×—×•××•×¡ ×©×œ ×˜×—×™× ×”'],['×¢× ×‘×¨',8,2,2,null],
  ['×œ×©×',1,4,2.5,null],['×œ×©×',2,2.5,3,null],['×œ×©×',3,4,3,null],['×œ×©×',4,2,2,null],['×œ×©×',5,4.5,3,null],['×œ×©×',6,3,2,null],['×œ×©×',7,3,4.5,null],['×œ×©×',8,3.5,3,null],
  ['×™× ×™×‘',1,5,4,'××‘×• ×“××‘×™'],['×™× ×™×‘',2,4,4,'×”×›×¨×'],['×™× ×™×‘',3,1,3,'××‘×• ×—×¡××Ÿ'],['×™× ×™×‘',4,3,3,'××©××•×•×©×”'],['×™× ×™×‘',5,3,2,'××‘×• ××“×”×'],['×™× ×™×‘',6,2,3,'××‘×• ×§×§×'],['×™× ×™×‘',7,3,3,'×—×•××•×¡ ×’×¨×’×¨×™×'],['×™× ×™×‘',8,4,3,'×›×¡×¤×™'],
  ['× ×¢×',1,3,3,null],['× ×¢×',2,3,3,null],['× ×¢×',3,2,4,'×—××•×¥'],['× ×¢×',4,3,3,null],['× ×¢×',5,3.5,4,null],['× ×¢×',6,3,4,null],['× ×¢×',7,2,2.5,null],['× ×¢×',8,4,5,null],
  ['×“×•×“×•',1,3,3,null],['×“×•×“×•',2,4,3,null],['×“×•×“×•',3,5,3,null],['×“×•×“×•',4,4,4,null],['×“×•×“×•',5,5,4,null],['×“×•×“×•',6,4,5,null],['×“×•×“×•',7,4,5,null],['×“×•×“×•',8,5,3,null],
  ['×¦×—×™',1,2,null,null],['×¦×—×™',2,2,null,null],['×¦×—×™',3,3,null,null],['×¦×—×™',4,3,null,null],['×¦×—×™',5,5,null,'×”×›×¨×'],['×¦×—×™',6,null,null,null],['×¦×—×™',7,2,null,null],['×¦×—×™',8,4,null,null],
  ['×“×•×“',1,3,1,null],['×“×•×“',2,2,3,null],['×“×•×“',3,4,2,null],['×“×•×“',4,2,4,null],['×“×•×“',5,2,2,null],['×“×•×“',6,4,4,null],['×“×•×“',7,1,3,null],['×“×•×“',8,2,2,null],
  ['×“× ×™×ª',1,1,3,null],['×“× ×™×ª',2,3,3,null],['×“× ×™×ª',3,3.5,null,null],['×“× ×™×ª',4,3,null,null],['×“× ×™×ª',5,2,4,null],['×“× ×™×ª',6,3.5,3,null],['×“× ×™×ª',7,2,3,null],['×“× ×™×ª',8,3,3,null],
  ['×’×™×œ',1,4,3,null],['×’×™×œ',2,3.5,3,null],['×’×™×œ',3,2,3,null],['×’×™×œ',4,1.5,2,null],['×’×™×œ',5,4.5,4,null],['×’×™×œ',6,4,3,null],['×’×™×œ',7,2,2,null],['×’×™×œ',8,3,3,null],
  ['××ª×Ÿ',1,2,null,null],['××ª×Ÿ',2,3,null,null],['××ª×Ÿ',3,4,null,null],['××ª×Ÿ',4,3,null,null],['××ª×Ÿ',5,3,null,null],['××ª×Ÿ',6,4,null,null],['××ª×Ÿ',7,2,null,null],['××ª×Ÿ',8,3,null,null],
  ['×¢×™×“×•',1,3,3,null],['×¢×™×“×•',2,1,2,null],['×¢×™×“×•',3,2,2,'××‘×• ×—×¡××Ÿ'],['×¢×™×“×•',4,4,3,null],['×¢×™×“×•',5,4,4,'××œ×™×”×•'],['×¢×™×“×•',6,3,2,null],['×¢×™×“×•',7,4,3,'×—×•××•×¡ ×©×œ ×˜×—×™× ×”'],['×¢×™×“×•',8,5,4,null],
  ['××™×›×œ',1,4,null,null],['××™×›×œ',2,3,null,null],['××™×›×œ',3,2,null,null],['××™×›×œ',4,1,null,null],['××™×›×œ',5,4,null,null],['××™×›×œ',6,3,null,null],['××™×›×œ',7,1,null,null],['××™×›×œ',8,3,null,null],
  ['××™×œ×•× ×”',1,3.5,null,null],['××™×œ×•× ×”',2,4,null,null],['××™×œ×•× ×”',3,1.5,null,null],['××™×œ×•× ×”',4,3,null,null],['××™×œ×•× ×”',5,3.5,null,null],['××™×œ×•× ×”',6,4.5,null,null],['××™×œ×•× ×”',7,3,null,null],['××™×œ×•× ×”',8,5,null,'××‘×• ××“×”×'],
  ['×“×•×“×• ××’×¡×™',1,4,null,null],['×“×•×“×• ××’×¡×™',2,4,null,null],['×“×•×“×• ××’×¡×™',3,4,null,null],['×“×•×“×• ××’×¡×™',4,4,null,null],['×“×•×“×• ××’×¡×™',5,5,null,null],['×“×•×“×• ××’×¡×™',6,4,null,null],['×“×•×“×• ××’×¡×™',7,4,null,null],['×“×•×“×• ××’×¡×™',8,3,null,null],
  ['×× ×•× ×™××™',1,2,null,null],['×× ×•× ×™××™',2,3,null,null],['×× ×•× ×™××™',3,1,null,'×§×•×¤×¡×ª ×©×™××•×¨×™×'],['×× ×•× ×™××™',4,4,null,null],['×× ×•× ×™××™',5,3,null,null],['×× ×•× ×™××™',6,5,null,null],['×× ×•× ×™××™',7,4,null,null],['×× ×•× ×™××™',8,5,null,'××‘×• ××“×”×'],
  ['×œ×™××•×¨',1,10,null,'××¡×œ×™'],['×œ×™××•×¨',2,5.5,null,null],['×œ×™××•×¨',3,2,null,'××‘×• ×—×¡××Ÿ'],['×œ×™××•×¨',4,8,null,null],['×œ×™××•×¨',5,10,null,'×”×›×¨×'],['×œ×™××•×¨',6,8,null,null],['×œ×™××•×¨',7,5,null,null],['×œ×™××•×¨',8,8,null,'××‘×• ××“×”×'],
  ['×“× ×™××œ ×',1,3,2,'×”×›×¨×'],['×“× ×™××œ ×',2,3,3,null],['×“× ×™××œ ×',3,4,4,'××‘×• ×—×¡××Ÿ'],['×“× ×™××œ ×',4,3,3,null],['×“× ×™××œ ×',5,5,4.5,null],['×“× ×™××œ ×',6,2,1,null],['×“× ×™××œ ×',7,3,3,null],['×“× ×™××œ ×',8,2,3,null],
  ['× ×™×¨',1,4,2,null],['× ×™×¨',2,2,4,null],['× ×™×¨',3,1,1,'××‘×• ×—×¡××Ÿ'],['× ×™×¨',4,3,4,null],['× ×™×¨',5,3,null,'×”×›×¨×'],['× ×™×¨',6,5,5,null],['× ×™×¨',7,4,null,null],['× ×™×¨',8,4,null,null],
  ['××•×¨×™×ª',1,4,3,null],['××•×¨×™×ª',2,2,3,null],['××•×¨×™×ª',3,5,1,null],['××•×¨×™×ª',4,3,3,null],['××•×¨×™×ª',5,4,4,null],['××•×¨×™×ª',6,4,4,null],['××•×¨×™×ª',7,3,5,null],['××•×¨×™×ª',8,5,3,null],
  ['×ª××™×¨',1,7,null,null],['×ª××™×¨',2,5,null,null],['×ª××™×¨',3,2,null,null],['×ª××™×¨',4,8,null,null],['×ª××™×¨',5,5,null,null],['×ª××™×¨',6,8,null,null],['×ª××™×¨',7,7,null,null],['×ª××™×¨',8,10,null,null],
  ['×× ×˜×•×œ×™',1,4,3,null],['×× ×˜×•×œ×™',2,3,2,null],['×× ×˜×•×œ×™',3,2,2,null],['×× ×˜×•×œ×™',4,1,3,null],['×× ×˜×•×œ×™',5,3,2,null],['×× ×˜×•×œ×™',6,3,4,null],['×× ×˜×•×œ×™',7,2,4,null],['×× ×˜×•×œ×™',8,5,4,null],
  ['×œ×™×”×™',1,2,5,null],['×œ×™×”×™',2,1,6,'×’× ×”×—××•×¦×™× ××’×¢×™×œ×™×'],['×œ×™×”×™',3,7,7,null],['×œ×™×”×™',4,1,8,null],['×œ×™×”×™',5,7,9,null],['×œ×™×”×™',6,8,8,null],['×œ×™×”×™',7,5,7,null],['×œ×™×”×™',8,9,8,'××¡×œ×™'],
  ['×¢×“×™ ×“×’×•×œ',1,4.5,null,null],['×¢×“×™ ×“×’×•×œ',2,3,null,null],['×¢×“×™ ×“×’×•×œ',3,1,null,null],['×¢×“×™ ×“×’×•×œ',4,2,null,null],['×¢×“×™ ×“×’×•×œ',5,5,null,'×”×›×™ ×˜×¢×™× ×”×›×™ ×”×¨×‘×” ×˜×—×™× ×”'],['×¢×“×™ ×“×’×•×œ',6,3,null,null],['×¢×“×™ ×“×’×•×œ',7,2,null,null],['×¢×“×™ ×“×’×•×œ',8,4,null,null],
  ['×‘×’×’',1,null,null,null],['×‘×’×’',2,1,null,null],['×‘×’×’',3,2,null,'××‘×• ×—×¡××Ÿ'],['×‘×’×’',4,7,null,null],['×‘×’×’',5,5,null,null],['×‘×’×’',6,6,null,null],['×‘×’×’',7,3,null,null],['×‘×’×’',8,10,null,null],
];

// Normalize scores > 5 scale to 1-5 by dividing by 2
function normalizeScale(score) {
  if (score === null) return null;
  // detect if this ranker uses a >5 scale based on their max
  return score; // handled per-ranker below
}

// Per ranker: normalize scores > 5 scale to 1-5
const rankers = [...new Set(rawData.map(d => d[0]))];
const rankerMaxScore = {};
rankers.forEach(r => {
  const scores = rawData.filter(d => d[0] === r && d[2] !== null).map(d => d[2]);
  rankerMaxScore[r] = Math.max(...scores);
});

function getScore(ranker, rawScore) {
  if (rawScore === null) return null;
  if (rankerMaxScore[ranker] > 5) return rawScore / 2;
  return rawScore;
}

function getPitaScore(ranker, rawPita) {
  if (rawPita === null) return null;
  if (rankerMaxScore[ranker] > 5) return rawPita / 2;
  return rawPita;
}

// Correct guesses
const CORRECT_NAMES = {1:'×—××•×“×•×ª',2:'××œ ×§×œ×—×”',3:'××‘×• ×—×¡××Ÿ',4:'×œ×™××•×¨',5:'×”×›×¨×',6:'××¡×œ×™',7:'×›×•×¨×–×™×Ÿ',8:'××‘×• ××“×”×'};
function isCorrect(placeId, guess) {
  if (!guess) return false;
  const correct = CORRECT_NAMES[placeId].toLowerCase();
  const g = guess.toLowerCase();
  if (correct === '××‘×• ×—×¡××Ÿ' && g.includes('××‘×• ×—×¡××Ÿ')) return true;
  if (correct === '×”×›×¨×' && g.includes('×”×›×¨×')) return true;
  if (correct === '××¡×œ×™' && g.includes('××¡×œ×™')) return true;
  if (correct === '××‘×• ××“×”×' && g.includes('××‘×• ××“×”×')) return true;
  if (correct === '×—××•×“×•×ª' && g.includes('×—××•×“')) return true;
  if (correct === '××œ ×§×œ×—×”' && (g.includes('×§×œ×—×”')||g.includes('×›×œ×—×”'))) return true;
  if (correct === '×œ×™××•×¨' && (g.includes('×œ×™××•×¨')||g.includes('×™×•×’×‘'))) return true;
  if (correct === '×›×•×¨×–×™×Ÿ' && g.includes('×›×•×¨×–×™×Ÿ')) return true;
  return g === correct;
}

// Compute per-ranker normalized stats
const rankerStats = {};
rankers.forEach(r => {
  const scores = rawData.filter(d => d[0] === r && d[2] !== null).map(d => getScore(r, d[2]));
  const mean = scores.reduce((a,b)=>a+b,0)/scores.length;
  const std = Math.sqrt(scores.reduce((a,b)=>a+(b-mean)**2,0)/scores.length) || 1;
  rankerStats[r] = { mean, std };
});

function zNorm(ranker, score) {
  if (score === null) return null;
  const s = getScore(ranker, score);
  const { mean, std } = rankerStats[ranker];
  return (s - mean) / std;
}

// Aggregate by place
const placeStats = {};
for (let p = 1; p <= 8; p++) {
  const entries = rawData.filter(d => d[1] === p && d[2] !== null);
  const rawScores = entries.map(d => getScore(d[0], d[2]));
  const normScores = entries.map(d => zNorm(d[0], d[2]));
  const pitaEntries = rawData.filter(d => d[1] === p && d[3] !== null);
  const pitaScores = pitaEntries.map(d => getPitaScore(d[0], d[3]));
  const avg = s => s.reduce((a,b)=>a+b,0)/s.length;
  const std = s => { const m=avg(s); return Math.sqrt(s.reduce((a,b)=>a+(b-m)**2,0)/s.length); };
  placeStats[p] = {
    id: p, name: PLACES[p].name, addr: PLACES[p].addr,
    rawAvg: avg(rawScores), rawStd: std(rawScores),
    normAvg: avg(normScores), normStd: std(normScores),
    pitaAvg: pitaScores.length ? avg(pitaScores) : null,
    n: rawScores.length, rawScores, normScores,
  };
}

const placesSorted = Object.values(placeStats).sort((a,b) => b.normAvg - a.normAvg);
const pitaSorted = Object.values(placeStats).filter(p=>p.pitaAvg!==null).sort((a,b)=>b.pitaAvg-a.pitaAvg);
const polarSorted = Object.values(placeStats).sort((a,b) => b.rawStd - a.rawStd);

// Update hero
document.getElementById('hero-ratings').textContent = rawData.filter(d=>d[2]!==null).length;
const totalCorrect = rawData.filter(d => d[4] !== null && typeof d[4] === 'string' && isCorrect(d[1], d[4])).length;
document.getElementById('hero-guesses').textContent = totalCorrect;

// PODIUM
const medals = ['ğŸ¥‡','ğŸ¥ˆ','ğŸ¥‰'], medalClass = ['gold','silver','bronze'];
const podium = document.getElementById('hummusPodium');
[0,1,2].forEach(i => {
  const p = placesSorted[i];
  podium.innerHTML += `<div class="podium-card ${medalClass[i]} fade-in">
    <div class="medal">${medals[i]}</div>
    <div class="place-rank">××§×•× ${i+1}</div>
    <div class="place-name">${p.name}</div>
    <div class="place-addr">${p.addr}</div>
    <div class="place-score">${p.normAvg.toFixed(2)}</div>
    <div class="place-score-label">×¦×™×•×Ÿ ×× ×•×¨××œ Â· ×××•×¦×¢ ×’×•×œ××™ ${p.rawAvg.toFixed(2)}</div>
  </div>`;
});

// SCORES TABLE
const maxNorm = Math.max(...placesSorted.map(p=>p.normAvg));
const minNorm = Math.min(...placesSorted.map(p=>p.normAvg));
const range = maxNorm - minNorm;
document.getElementById('scoresTable').innerHTML = placesSorted.map((p,i) => {
  const barW = ((p.normAvg - minNorm) / range * 100).toFixed(1);
  const pitaBarW = p.pitaAvg ? (p.pitaAvg / 5 * 100).toFixed(1) : 0;
  return `<div class="score-row">
    <div class="row-num">${i+1}</div>
    <div><div class="row-name">${p.name}</div><div class="row-addr">${p.addr}</div></div>
    <div>
      <div style="font-size:0.7rem;opacity:0.5;margin-bottom:2px;">×—×•××•×¡ (× ×•×¨××œ)</div>
      <div class="bar-container"><div class="bar-fill bar-hummus" style="width:${barW}%"></div></div>
      ${p.pitaAvg ? `<div style="font-size:0.7rem;opacity:0.5;margin:4px 0 2px;">×¤×™×ª×”</div><div class="bar-container"><div class="bar-fill bar-pita" style="width:${pitaBarW}%"></div></div>` : ''}
    </div>
    <div class="row-avg">${p.rawAvg.toFixed(1)}</div>
  </div>`;
}).join('');

// CATEGORY WINNERS
document.getElementById('categoryWinners').innerHTML = `
  <div class="cat-card">
    <div class="cat-title">ğŸ«˜ ×˜×•×¤ ×—×•××•×¡ (×××•×¦×¢ ×× ×•×¨××œ)</div>
    ${placesSorted.slice(0,5).map((p,i)=>`<div class="mini-winner"><span class="mini-name">${medals[i]||'Â·'} ${p.name}</span><span class="mini-score">${p.normAvg.toFixed(2)}</span></div>`).join('')}
  </div>
  <div class="cat-card">
    <div class="cat-title">ğŸ«“ ×˜×•×¤ ×¤×™×ª×” (×××•×¦×¢ ×’×•×œ××™)</div>
    ${pitaSorted.slice(0,5).map((p,i)=>`<div class="mini-winner"><span class="mini-name">${medals[i]||'Â·'} ${p.name}</span><span class="mini-score">${p.pitaAvg.toFixed(2)}</span></div>`).join('')}
  </div>`;

// POLARIZING
const maxStd = Math.max(...polarSorted.map(p=>p.rawStd));
document.getElementById('polarGrid').innerHTML = polarSorted.map((p,i) => `
  <div class="polar-card fade-in">
    <div class="polar-place">${i===0?'ğŸŒªï¸ ':''}<strong>${p.name}</strong></div>
    <div class="polar-stat"><span class="polar-label">×¡×˜×™×™×ª ×ª×§×Ÿ</span><span class="polar-value">${p.rawStd.toFixed(2)}</span></div>
    <div class="polar-stat"><span class="polar-label">××™× ×™××•×</span><span class="polar-value">${Math.min(...p.rawScores).toFixed(1)}</span></div>
    <div class="polar-stat"><span class="polar-label">××§×¡×™××•×</span><span class="polar-value">${Math.max(...p.rawScores).toFixed(1)}</span></div>
    <div class="polar-stat"><span class="polar-label">×××•×¦×¢</span><span class="polar-value">${p.rawAvg.toFixed(2)}</span></div>
    <div class="std-indicator"><div class="std-marker" style="left:${(p.rawStd/maxStd*100).toFixed(0)}%"></div></div>
  </div>`).join('');

// HEAT TABLE
const heatTable = document.getElementById('heatTable');
const allScores = rawData.filter(d=>d[2]!==null).map(d=>getScore(d[0],d[2]));
const gMin = Math.min(...allScores), gMax = Math.max(...allScores);
function scoreToColor(score) {
  if (score === null) return '#F0EBE0';
  const t = (score - gMin)/(gMax - gMin);
  const r = Math.round(245 - t*(245-181));
  const g = Math.round(237 - t*(237-69));
  const b = Math.round(214 - t*(214-27));
  return `rgb(${r},${g},${b})`;
}
function textColor(score) {
  if (score === null) return '#CCC';
  return (score - gMin)/(gMax - gMin) > 0.5 ? '#FAF4E8' : '#3D2B0E';
}
let htHtml = '<thead><tr><th style="text-align:right;writing-mode:initial;font-size:0.8rem;">×©×•×¤×˜</th>';
[1,2,3,4,5,6,7,8].forEach(p => { htHtml += `<th>${PLACES[p].name}</th>`; });
htHtml += '</tr></thead><tbody>';
rankers.forEach(ranker => {
  htHtml += `<tr><td class="row-header">${ranker}</td>`;
  [1,2,3,4,5,6,7,8].forEach(p => {
    const entry = rawData.find(d=>d[0]===ranker && d[1]===p);
    const raw = entry ? entry[2] : null;
    const score = raw !== null ? getScore(ranker, raw) : null;
    htHtml += `<td><div class="heat-cell" style="background:${scoreToColor(score)};color:${textColor(score)};">${score !== null ? score.toFixed(1) : 'â€”'}</div></td>`;
  });
  htHtml += '</tr>';
});
htHtml += '</tbody>';
heatTable.innerHTML = htHtml;

// CHARTS
const radarCtx = document.getElementById('radarChart').getContext('2d');
new Chart(radarCtx, {
  type: 'radar',
  data: {
    labels: [1,2,3,4,5,6,7,8].map(p=>PLACES[p].name),
    datasets: [
      { label: '×××•×¦×¢ ×—×•××•×¡', data: [1,2,3,4,5,6,7,8].map(p=>placeStats[p].rawAvg), backgroundColor: 'rgba(200,148,26,0.2)', borderColor: '#C8941A', borderWidth: 2, pointBackgroundColor: '#C8941A' },
      { label: '×××•×¦×¢ ×¤×™×ª×”', data: [1,2,3,4,5,6,7,8].map(p=>placeStats[p].pitaAvg||0), backgroundColor: 'rgba(107,124,58,0.2)', borderColor: '#6B7C3A', borderWidth: 2, pointBackgroundColor: '#6B7C3A' }
    ]
  },
  options: { responsive: true, plugins: { legend: { position: 'bottom' } }, scales: { r: { beginAtZero: true, min: 0, max: 5 } } }
});

const scatterCtx = document.getElementById('scatterChart').getContext('2d');
const scatterData = Object.values(placeStats).filter(p=>p.pitaAvg!==null).map(p=>({x:p.rawAvg,y:p.pitaAvg,label:p.name}));
new Chart(scatterCtx, {
  type: 'scatter',
  data: { datasets: [{ label: '××§×•××•×ª', data: scatterData, backgroundColor: '#C8941A', pointRadius: 8, pointHoverRadius: 11 }] },
  options: { responsive: true, plugins: { legend: { display: false }, tooltip: { callbacks: { label: (ctx) => `${scatterData[ctx.dataIndex].label}: ×—×•××•×¡ ${scatterData[ctx.dataIndex].x.toFixed(2)}, ×¤×™×ª×” ${scatterData[ctx.dataIndex].y.toFixed(2)}` } } }, scales: { x: { title: { display: true, text: '×—×•××•×¡' } }, y: { title: { display: true, text: '×¤×™×ª×”' } } } }
});

const barCtx = document.getElementById('barChart').getContext('2d');
new Chart(barCtx, {
  type: 'bar',
  data: {
    labels: placesSorted.map(p=>p.name),
    datasets: [
      { label: '×¦×™×•×Ÿ ×× ×•×¨××œ', data: placesSorted.map(p=>p.normAvg), backgroundColor: placesSorted.map((_,i)=>i<3?'#C8941A':'rgba(200,148,26,0.5)'), borderRadius: 6 },
      { label: '×××•×¦×¢ ×’×•×œ××™', data: placesSorted.map(p=>p.rawAvg), backgroundColor: 'rgba(107,124,58,0.5)', borderRadius: 6 }
    ]
  },
  options: { responsive: true, plugins: { legend: { position: 'top' } }, scales: { y: { beginAtZero: false } } }
});

// DIVERSITY
const rankerDiv = rankers.map(r => {
  const scores = rawData.filter(d=>d[0]===r && d[2]!==null).map(d=>getScore(r,d[2]));
  const mean = scores.reduce((a,b)=>a+b,0)/scores.length;
  const std = Math.sqrt(scores.reduce((a,b)=>a+(b-mean)**2,0)/scores.length);
  return { name: r, std, range: Math.max(...scores)-Math.min(...scores) };
}).filter(r=>!isNaN(r.std) && r.std > 0);
const sortedByStd = [...rankerDiv].sort((a,b)=>b.std-a.std);
const maxRStd = sortedByStd[0].std;

document.getElementById('diverseList').innerHTML = sortedByStd.slice(0,6).map(r => `
  <div class="diversity-item">
    <div class="div-name">${r.name}</div>
    <div style="height:8px;background:var(--warm);border-radius:4px;overflow:hidden;"><div style="height:100%;width:${(r.std/maxRStd*100).toFixed(0)}%;background:linear-gradient(90deg,var(--rust),var(--gold));border-radius:4px;"></div></div>
    <div class="div-val">${r.std.toFixed(2)}</div>
  </div>`).join('');

document.getElementById('indifferentList').innerHTML = [...sortedByStd].reverse().slice(0,6).map(r => `
  <div class="diversity-item">
    <div class="div-name">${r.name}</div>
    <div style="height:8px;background:var(--warm);border-radius:4px;overflow:hidden;"><div style="height:100%;width:${(r.std/maxRStd*100).toFixed(0)}%;background:linear-gradient(90deg,var(--olive),#8FA84A);border-radius:4px;"></div></div>
    <div class="div-val" style="color:var(--olive);">${r.std.toFixed(2)}</div>
  </div>`).join('');

// RANKER CARDS
const rankerGuesses = {};
rankers.forEach(r => {
  const guesses = rawData.filter(d=>d[0]===r && d[4]!==null && typeof d[4]==='string');
  const correct = guesses.filter(d=>isCorrect(d[1],d[4]));
  rankerGuesses[r] = { guesses, correct };
});
const guessersSorted = rankers.map(r=>({name:r, count:rankerGuesses[r].correct.length, total:rankerGuesses[r].guesses.length})).filter(r=>r.total>0).sort((a,b)=>b.count-a.count);
const maxCorrect = guessersSorted.length ? guessersSorted[0].count : 0;

if (guessersSorted.length && maxCorrect > 0) {
  const winners = guessersSorted.filter(r=>r.count===maxCorrect);
  document.getElementById('guessWinnerSection').style.display = 'block';
  // ×œ×™××•×¨ is female
  const winnerNames = winners.map(r=>r.name).join(', ');
  const isLior = winners.length === 1 && winners[0].name === '×œ×™××•×¨';
  document.getElementById('guessWinnerName').textContent = `${winnerNames} â€” ${isLior ? '××œ×•×¤×ª ×”× ×™×—×•×©×™×!' : '××œ×•×£ ×”× ×™×—×•×©×™×!'} ğŸŒ¶ï¸`;
  document.getElementById('guessWinnerDesc').textContent = `${isLior ? '×–×™×”×ª×”' : '×–×™×”×”/×”'} × ×›×•×Ÿ ${maxCorrect} ××ª×•×š ${winners[0].total} ××§×•××•×ª`;
}

const rankersGrid = document.getElementById('rankersGrid');
[...rankers].sort((a,b)=>rankerGuesses[b].correct.length-rankerGuesses[a].correct.length).forEach(r => {
  const g = rankerGuesses[r];
  const div = rankerDiv.find(rd=>rd.name===r);
  const scores = rawData.filter(d=>d[0]===r && d[2]!==null).map(d=>getScore(r,d[2]));
  const avgScore = scores.reduce((a,b)=>a+b,0)/scores.length;
  const isChampion = g.correct.length === maxCorrect && maxCorrect > 0;
  const isDiverse = div && div.std > maxRStd * 0.75;
  let badge = '';
  if (isChampion && r === '×œ×™××•×¨') badge = '<div class="ranker-badge champion">ğŸŒ¶ï¸ ××œ×•×¤×ª × ×™×—×•×©×™×</div>';
  else if (isChampion) badge = '<div class="ranker-badge champion">ğŸŒ¶ï¸ ××œ×•×£ × ×™×—×•×©×™×</div>';
  else if (isDiverse) badge = '<div class="ranker-badge sharp">âš¡ ××’×•×•×Ÿ</div>';
  const guessPills = rawData.filter(d=>d[0]===r && d[4]!==null && typeof d[4]==='string').map(d => {
    const ok = isCorrect(d[1],d[4]);
    return `<span class="pill ${ok?'correct':'wrong'}">${d[4]} ${ok?'âœ“':'âœ—'}</span>`;
  }).join('');
  rankersGrid.innerHTML += `<div class="ranker-card fade-in">
    ${badge}
    <div class="ranker-name">${r === '×ª××™×¨' ? r + ' ğŸ‘‘' : r}</div>
    <div class="ranker-stat">×××•×¦×¢ ×¦×™×•×Ÿ: <span>${avgScore.toFixed(1)}</span></div>
    ${div ? `<div class="ranker-stat">×©×•× ×•×ª: <span>${div.std.toFixed(2)}</span></div>` : ''}
    ${g.correct.length > 0 ? `<div class="ranker-stat">× ×™×—×•×©×™× × ×›×•× ×™×: <span style="color:var(--olive)">${g.correct.length}/${g.total}</span></div>` : ''}
    ${guessPills ? `<div class="guess-pills">${guessPills}</div>` : '<div style="font-size:0.8rem;opacity:0.4;margin-top:0.5rem;">×œ× × ×™×—×©/×” ××§×•××•×ª</div>'}
  </div>`;
});
</script>
</body>
</html>
